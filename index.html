<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Notes Test</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --toolbar: #f1f3f4;
            --text: #202124;
        }

        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: sans-serif;
            background: var(--bg-color);
            touch-action: none; /* Prevents scrolling while drawing */
        }

        /* HEADER */
        .header {
            height: 60px;
            background: var(--toolbar);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .title {
            font-size: 22px;
            font-weight: bold;
            color: var(--text);
            padding: 10px;
            transition: color 0.3s;
        }

        /* CANVAS AREA */
        #canvas-wrapper {
            flex: 1;
            position: relative;
            background: white;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        /* THE CARD (Hidden by default) */
        #reveal-card {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-5deg) scale(0.8);
            width: 200px;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            pointer-events: none; /* Allows drawing over the card */
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.3));
        }

        #reveal-card.show {
            opacity: 1;
        }

        /* FOOTER */
        .footer {
            height: 60px;
            background: var(--toolbar);
            display: flex;
            align-items: center;
            justify-content: center;
            border-top: 1px solid #ddd;
        }
        
        .btn {
            padding: 10px 20px;
            font-size: 20px;
            color: #5f6368;
            background: none;
            border: none;
        }

    </style>
</head>
<body>

    <div class="header">
        <span>‚ò∞</span>
        <!-- SECRET TRIGGER: The Title -->
        <span class="title" id="secret-btn">Notes</span>
        <span>‚ãÆ</span>
    </div>

    <div id="canvas-wrapper">
        <canvas id="paint-canvas"></canvas>
        <!-- The 3 of Hearts is pre-loaded but invisible -->
        <img id="reveal-card" src="https://deckofcardsapi.com/static/img/3H.png" alt="Card">
    </div>

    <div class="footer">
        <button class="btn" onclick="clearPad()">üóëÔ∏è</button>
    </div>

    <script>
        // --- 1. DRAWING LOGIC (To make it look like a real app) ---
        const canvas = document.getElementById('paint-canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('canvas-wrapper');

        // Resize canvas to full screen
        function resize() {
            canvas.width = wrapper.clientWidth;
            canvas.height = wrapper.clientHeight;
        }
        window.onresize = resize;
        resize();

        let painting = false;

        function startPosition(e) {
            painting = true;
            draw(e);
        }
        function finishedPosition() {
            painting = false;
            ctx.beginPath();
        }
        function draw(e) {
            if (!painting) return;
            e.preventDefault(); // Stop scrolling on phone
            
            const touch = e.touches ? e.touches[0] : e;
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#333';

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        // Touch events for Android
        canvas.addEventListener('touchstart', startPosition);
        canvas.addEventListener('touchend', finishedPosition);
        canvas.addEventListener('touchmove', draw);
        
        // Mouse events for Computer testing
        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', finishedPosition);
        canvas.addEventListener('mousemove', draw);

        function clearPad() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('reveal-card').classList.remove('show');
        }

        // --- 2. VOICE LOGIC (The Trick) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const titleBtn = document.getElementById('secret-btn');
        const cardImage = document.getElementById('reveal-card');
        
        let recognition;
        let isListening = false;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true; // Keep listening
            recognition.interimResults = true; // Faster processing
            recognition.lang = 'en-US';

            // VISUAL FEEDBACK: Title turns Blue when listening
            recognition.onstart = () => {
                console.log("Mic Active");
                titleBtn.style.color = "#1a73e8"; // Blue
                isListening = true;
            };

            recognition.onend = () => {
                console.log("Mic Inactive");
                titleBtn.style.color = "#202124"; // Black
                
                // If we want it to stay on, we auto-restart here
                if(isListening) recognition.start();
            };

            recognition.onresult = (event) => {
                const last = event.results.length - 1;
                const command = event.results[last][0].transcript.toLowerCase();
                
                // DEBUG: Verify what the phone hears in the browser console
                console.log("Heard:", command);

                // --- THE TRIGGER ---
                // We check if the phrase "ace of diamonds" is in the sentence
                if (command.includes("ace of diamonds")) {
                    revealTheCard();
                }
            };

        } else {
            alert("This browser doesn't support voice. Please use Chrome.");
        }

        // Toggle Listening when clicking the Title
        titleBtn.addEventListener('click', () => {
            if (!isListening) {
                try {
                    recognition.start();
                    isListening = true;
                } catch (e) { console.error(e); }
            } else {
                isListening = false;
                recognition.stop();
            }
        });

        function revealTheCard() {
            // Make the 3 of Hearts visible
            cardImage.classList.add('show');
            
            // Stop listening so it doesn't trigger again accidentally
            isListening = false;
            recognition.stop();
        }

    </script>
</body>
</html>

