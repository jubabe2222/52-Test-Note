<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==================================================================
        // ‚úÖ YOUR FIREBASE KEYS
        // ==================================================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyCUsarWlf5256d-n96ZwuxJmInNQ2tU70o",
            authDomain: "magicdeck-ea75a.firebaseapp.com",
            projectId: "magicdeck-ea75a",
            storageBucket: "magicdeck-ea75a.firebasestorage.app",
            messagingSenderId: "134148843112",
            appId: "1:134148843112:web:0227c55453ee51d5f57ddd",
            measurementId: "G-4Y3MMSN4NF"
        };

        // ==================================================================
        
        let app, auth, db;
        let user = null;
        let lastTimestamp = Date.now();

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            
            signInAnonymously(auth).catch((err) => console.error("Auth Failed:", err));
            onAuthStateChanged(auth, (u) => {
                if (u) {
                    user = u;
                    checkMode();
                }
            });
        } catch (e) { 
            console.error("Firebase Init Error:", e);
        }

        function checkMode() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'receiver') {
                initReceiver();
            } else {
                initSpectator();
            }
        }

        // ==================================================================
        // üé© SPECTATOR MODE
        // ==================================================================

        function initSpectator() {
            document.getElementById('spectator-root').classList.remove('hidden');
        }

        window.toggleSelection = async function(btn) {
            const scroller = document.getElementById('deck-scroller');
            const icon = btn.querySelector('svg');
            
            // CHECK IF ALREADY LOCKED (Green)
            const isLocked = btn.classList.contains('bg-green-500');

            if (isLocked) {
                // --- UNLOCK ACTION ---
                // 1. Revert Visuals
                btn.classList.remove('bg-green-500', 'border-green-500', 'scale-110');
                btn.classList.add('bg-black/40', 'border-white/50');
                
                // 2. Unlock Scroll
                scroller.classList.remove('pointer-events-none', 'opacity-50');
                
            } else {
                // --- LOCK ACTION ---
                
                // 1. Find active card
                const center = scroller.getBoundingClientRect().width / 2;
                const cards = document.getElementsByClassName('card-element');
                let idx = -1, min = Infinity;

                for(let i=0; i<cards.length; i++){
                    const rect = cards[i].getBoundingClientRect();
                    const dist = Math.abs(center - (rect.left + rect.width/2));
                    if(dist < min){ min = dist; idx = i; }
                }

                if(idx !== -1) {
                    const selectedCard = cards[idx].dataset.name;

                    // 2. Visuals: Turn Green & Pulse
                    btn.classList.remove('bg-black/40', 'border-white/50');
                    btn.classList.add('bg-green-500', 'border-green-500', 'scale-110');
                    
                    // 3. Lock Scroll (Prevent swiping)
                    scroller.classList.add('pointer-events-none'); // Freezes interaction
                    
                    // 4. Send to Cloud
                    if (user && db) {
                        const docRef = doc(db, 'magic_data', 'live_session');
                        await setDoc(docRef, {
                            card: selectedCard,
                            timestamp: Date.now()
                        });
                    }
                }
            }
        }

        // ==================================================================
        // üì± RECEIVER MODE (Samsung Notes Replica)
        // ==================================================================

        function initReceiver() {
            document.getElementById('spectator-root').remove();
            document.getElementById('receiver-root').classList.remove('hidden');
            
            initCanvas();

            const docRef = doc(db, 'magic_data', 'live_session');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.timestamp > lastTimestamp) {
                        lastTimestamp = data.timestamp;
                        showSecretReveal(data.card);
                    }
                }
            });
        }

        let revealTimer;
        function showSecretReveal(text) {
            const el = document.getElementById('secret-title');
            el.innerText = text;
            el.style.opacity = '0.3'; 
            
            if (revealTimer) clearTimeout(revealTimer);

            // Auto-hide after 30 seconds
            revealTimer = setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => { el.innerText = "Title"; el.style.opacity = '1'; }, 500);
            }, 30000);
        }

        // --- DRAWING LOGIC ---
        let ctx, canvas;
        let isDrawing = false;
        let currentTool = 'pen';

        function initCanvas() {
            canvas = document.getElementById('drawing-board');
            const container = document.getElementById('canvas-container');
            const dpr = window.devicePixelRatio || 1;
            canvas.width = container.offsetWidth * dpr;
            canvas.height = container.offsetHeight * dpr;
            ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            usePen();

            ['mousedown', 'touchstart'].forEach(evt => canvas.addEventListener(evt, startDraw, {passive: false}));
            ['mousemove', 'touchmove'].forEach(evt => canvas.addEventListener(evt, draw, {passive: false}));
            ['mouseup', 'touchend'].forEach(evt => canvas.addEventListener(evt, endDraw));
        }

        function startDraw(e) {
            e.preventDefault();
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function endDraw() {
            isDrawing = false;
            ctx.beginPath();
        }

        window.usePen = function() {
            currentTool = 'pen';
            ctx.globalCompositeOperation = 'source-over';
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2;
            setActiveIcon('icon-pen');
        }

        window.useEraser = function() {
            currentTool = 'eraser';
            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineWidth = 25;
            setActiveIcon('icon-eraser');
        }

        function setActiveIcon(id) {
            document.querySelectorAll('.toolbar-icon').forEach(el => el.classList.remove('text-white', 'text-gray-500'));
            document.querySelectorAll('.toolbar-icon').forEach(el => el.classList.add('text-gray-500'));
            const active = document.getElementById(id);
            if(active) {
                active.classList.remove('text-gray-500');
                active.classList.add('text-white');
            }
        }

        window.toggleFullScreen = function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch((e) => {
                    console.log("Fullscreen blocked:", e);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .bg-samsung-dots {
            background-color: #FDF2E3;
            background-image: radial-gradient(#d4c5b0 1.5px, transparent 1.5px);
            background-size: 24px 24px;
        }
    </style>
</head>
<body class="bg-black h-screen w-screen overflow-hidden text-white font-sans select-none">

    <!-- ============================================= -->
    <!-- SPECTATOR VIEW (THE DECK) -->
    <!-- ============================================= -->
    <div id="spectator-root" class="hidden h-full w-full flex flex-col bg-zinc-950">
        <!-- Overlay -->
        <div id="start-overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-500">
            <div class="text-center p-6">
                <div class="text-6xl mb-6">üëÅÔ∏è</div>
                <button onclick="document.getElementById('start-overlay').style.display='none'; document.getElementById('home-menu').classList.remove('hidden');" class="px-8 py-3 border border-gray-600 rounded-full text-sm tracking-widest hover:bg-gray-800 transition-colors">START</button>
            </div>
        </div>

        <!-- Menu -->
        <div id="home-menu" class="hidden w-full h-full flex flex-col items-center justify-center p-6 space-y-3 overflow-y-auto">
            <h2 class="text-xs uppercase tracking-[0.2em] text-gray-500 mb-8">Visual Set</h2>
            <div class="grid grid-cols-2 gap-3 w-full max-w-sm">
                <button onclick="loadCategory('cards')" class="col-span-2 py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex items-center justify-center active:scale-95"><span class="text-2xl mr-3">üÉè</span> Cards</button>
                <button onclick="loadCategory('bini')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center active:scale-95"><span class="text-2xl">üå∏</span> BINI</button>
                <button onclick="loadCategory('brands')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center active:scale-95"><span class="text-2xl">üè∑Ô∏è</span> Brands</button>
                <button onclick="loadCategory('colors')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center active:scale-95"><span class="text-2xl">üé®</span> Colors</button>
                <button onclick="loadCategory('esp')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center active:scale-95"><span class="text-2xl">üîÆ</span> ESP</button>
                <button onclick="loadCategory('places')" class="col-span-2 py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex items-center justify-center active:scale-95"><span class="text-2xl mr-3">üåç</span> Places</button>
            </div>
        </div>

        <!-- Carousel -->
        <div id="carousel-view" class="hidden w-full h-full flex flex-col items-center justify-center relative">
            <button onclick="goHome()" class="absolute top-6 left-6 z-20 p-2 text-white/50 bg-black/20 rounded-full">Back</button>
            <div id="category-title" class="absolute top-8 text-xs font-bold tracking-[0.3em] text-zinc-500 uppercase z-10">CATEGORY</div>
            <div id="deck-scroller" class="relative w-full h-3/4 flex overflow-x-auto snap-x snap-mandatory no-scrollbar items-center px-[calc(50vw-140px)] z-10 transition-opacity duration-300"></div>
            
            <!-- CONFIRM BUTTON -->
            <!-- Fixed at bottom with gap from card -->
            <div class="fixed bottom-12 z-20 w-full flex justify-center pointer-events-none">
                <button onclick="toggleSelection(this)" class="pointer-events-auto w-20 h-20 rounded-full border-2 border-white/50 bg-black/40 backdrop-blur-md flex items-center justify-center transition-all duration-300 shadow-xl active:scale-95 hover:bg-black/60">
                    <!-- Check Icon -->
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- RECEIVER VIEW (SAMSUNG NOTES REPLICA) -->
    <!-- ============================================= -->
    <div id="receiver-root" class="hidden h-screen w-screen flex flex-col bg-samsung-dots text-gray-800 overflow-hidden relative">
        
        <!-- Top Bar -->
        <div class="h-14 flex items-center justify-between px-4 z-10">
            <div class="flex items-center space-x-4">
                <span class="text-2xl font-light text-gray-500">‚Äπ</span>
                <!-- THE REVEAL -->
                <span id="secret-title" class="text-xl font-semibold text-gray-700 transition-opacity duration-500">Title</span>
            </div>
            <div class="flex items-center space-x-5 text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <span class="text-2xl font-light">+</span>
                
                <!-- FULL SCREEN TRIGGER (3 DOTS) -->
                <div onclick="toggleFullScreen()" class="flex flex-col space-y-1 p-2 cursor-pointer">
                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                </div>
            </div>
        </div>

        <!-- Canvas -->
        <div id="canvas-container" class="flex-grow w-full relative touch-none">
            <canvas id="drawing-board" class="absolute inset-0 w-full h-full block"></canvas>
        </div>

        <!-- Bottom Toolbar -->
        <div class="h-14 bg-[#222222] flex items-center justify-between px-6 pb-1">
            
            <button onclick="usePen()" id="icon-pen" class="toolbar-icon text-white transform active:scale-90 transition-transform">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            </button>
            <button class="toolbar-icon text-gray-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
            <button class="toolbar-icon text-gray-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
            <button class="toolbar-icon text-gray-500 font-serif font-bold text-xl">T</button>
            <button onclick="useEraser()" id="icon-eraser" class="toolbar-icon text-gray-500 transform active:scale-90 transition-transform">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
            </button>
            <div class="flex space-x-4 ml-4 pl-4 border-l border-gray-700">
                <button class="text-gray-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg></button>
                <button class="text-gray-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"/></svg></button>
            </div>
        </div>
    </div>

    <!-- SPECTATOR LOGIC -->
    <script>
        const DATA = {
            cards: { title: "Playing Cards", type: "poker", items: [] },
            bini: { title: "BINI Members", type: "photo", items: [
                { name: "Aiah", image: "Aiah.png" }, { name: "Colet", image: "Colet.png" }, { name: "Gwen", image: "Gwen.png" }, { name: "Jhoanna", image: "hoanna.png" }, { name: "Maloi", image: "Maloi.png" }, { name: "Mikha", image: "Mikha.png" }, { name: "Sheena", image: "Sheena.png" }, { name: "Stacey", image: "Stacey.png" }
            ]},
            brands: { title: "Famous Brands", type: "photo", items: [
                { name: "Amazon", image: "Amazon.png" }, { name: "Apple", image: "Apple.png" }, { name: "Canon", image: "Canon.png" }, { name: "Coca Cola", image: "Coca Cola.png" }, { name: "Fedex", image: "Fedex.png" }, { name: "Instagram", image: "Instagram.png" }, { name: "McDonalds", image: "Mcdonalds.png" }, { name: "Nintendo", image: "Nintendo.png" }, { name: "Nike", image: "Nike.png" }, { name: "Shell", image: "Shell.png" }, { name: "Starbucks", image: "Starbucks.png" }, { name: "Twitter", image: "Twitter.png" }
            ]},
            colors: { title: "Colors", type: "photo", items: [
                { name: "Black", image: "Black.png" }, { name: "Blue", image: "Blue.png" }, { name: "Brown", image: "Brown.png" }, { name: "Gray", image: "Gray.png" }, { name: "Green", image: "Green.png" }, { name: "Orange", image: "Orange.png" }, { name: "Pink", image: "Pink.png" }, { name: "Red", image: "Red.png" }, { name: "Violet", image: "Violet.png" }, { name: "White", image: "White.png" }, { name: "Yellow", image: "Yellow.png" }
            ]},
            esp: { title: "ESP Symbols", type: "photo", items: [
                { name: "Circle", image: "Circle.png" }, { name: "Cross", image: "Cross.png" }, { name: "Square", image: "Square.png" }, { name: "Star", image: "Star.png" }, { name: "Wavy Lines", image: "Wavy.png" }
            ]},
            places: { title: "Famous Places", type: "photo", items: [
                { name: "Chocolate Hills", image: "Chocolate Hills.png" }, { name: "Eiffel Tower", image: "Eiffel Tower.png" }, { name: "Luneta Park", image: "Luneta Park.png" }, { name: "Pyramid", image: "Pyramid.png" }, { name: "Rice Terraces", image: "Rice Terraces.png" }, { name: "Statue of Liberty", image: "Statue of Liberty.png" }, { name: "Taj Mahal", image: "Taj Mahal.png" }, { name: "Tower of Pisa", image: "Tower of Pisa.png" }
            ]}
        };
        const suits = [{n:'Spades',s:'‚ô†',c:'text-black'},{n:'Hearts',s:'‚ô•',c:'text-red-600'},{n:'Clubs',s:'‚ô£',c:'text-black'},{n:'Diamonds',s:'‚ô¶',c:'text-red-600'}];
        const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        for(let s of suits){ for(let r of ranks){ DATA.cards.items.push({rank:r,suit:s.n,symbol:s.s,color:s.c,name:`${r} of ${s.n}`,type:'poker'}); }}

        window.loadCategory = function(key) {
            const data = DATA[key];
            let items = [...data.items].sort(() => Math.random() - 0.5);
            const scroller = document.getElementById('deck-scroller');
            scroller.innerHTML = '';
            document.getElementById('category-title').innerText = data.title;

            items.forEach(item => {
                const el = document.createElement('div');
                el.className = `card-element flex-shrink-0 w-[280px] h-[420px] rounded-2xl shadow-2xl snap-center mx-4 relative flex flex-col justify-between border-4 border-transparent overflow-hidden bg-white mb-4`;
                el.dataset.name = item.name;

                if (data.type === 'poker') {
                    el.classList.add('p-6');
                    el.innerHTML = `<div class="text-3xl font-bold ${item.color} flex flex-col items-center leading-none"><span>${item.rank}</span><span class="text-2xl">${item.symbol}</span></div><div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl ${item.color}">${item.symbol}</span></div><div class="text-3xl font-bold ${item.color} flex flex-col items-center leading-none transform rotate-180"><span>${item.rank}</span><span class="text-2xl">${item.symbol}</span></div>`;
                } else {
                    el.innerHTML = `<img src="${item.image}" class="absolute inset-0 w-full h-full object-contain bg-white pb-10" onerror="this.src='https://placehold.co/600x900?text=Image+Missing'"><div class="absolute bottom-0 w-full text-center bg-black/80 py-3 border-t border-white/10"><h2 class="text-white font-bold text-lg uppercase tracking-widest leading-none">${item.name}</h2></div>`;
                }
                scroller.appendChild(el);
            });

            document.getElementById('home-menu').classList.add('hidden');
            document.getElementById('carousel-view').classList.remove('hidden');
        }

        window.goHome = function() {
            document.getElementById('carousel-view').classList.add('hidden');
            document.getElementById('home-menu').classList.remove('hidden');
        }
    </script>
</body>
</html>


