<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Magic Debug Mode</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --toolbar: #f1f3f4;
            --text: #202124;
        }

        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: sans-serif;
            background: var(--bg-color);
            touch-action: none;
        }

        /* HEADER */
        .header {
            height: 60px;
            background: var(--toolbar);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .title {
            font-size: 22px;
            font-weight: bold;
            color: var(--text);
            padding: 10px;
            border: 1px solid transparent;
        }

        /* CANVAS AREA */
        #canvas-wrapper {
            flex: 1;
            position: relative;
            background: white;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            position: relative;
            z-index: 1; /* Canvas is below the card */
        }

        /* THE CARD */
        #reveal-card {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-5deg) scale(0.8);
            width: 200px;
            opacity: 0; 
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
            z-index: 10; /* Card is ABOVE the canvas */
            border: 2px solid red; /* Temporary Red Border to prove it exists */
        }

        #reveal-card.show {
            opacity: 1;
        }

        /* DEBUG CONSOLE (The Log Tracker) */
        #debug-console {
            height: 150px;
            background-color: #000;
            color: #0f0;
            font-family: monospace;
            font-size: 12px;
            overflow-y: scroll;
            padding: 10px;
            border-top: 2px solid #333;
            z-index: 100;
        }
        
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #333; }
        .log-error { color: #ff5555; }
        .log-highlight { color: #ffff55; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <span>â˜°</span>
        <span class="title" id="secret-btn">Notes (Tap Me)</span>
        <span>â‹®</span>
    </div>

    <div id="canvas-wrapper">
        <canvas id="paint-canvas"></canvas>
        <!-- Added a red border to the image style so we can see if it loads but is transparent -->
        <img id="reveal-card" src="https://deckofcardsapi.com/static/img/3H.png" alt="Card">
    </div>

    <!-- The Logger -->
    <div id="debug-console" id="logger">
        <div class="log-line">--- App Loaded ---</div>
    </div>

    <script>
        // --- LOGGING UTILITY ---
        const debugConsole = document.getElementById('debug-console');
        function log(msg, type = 'normal') {
            const div = document.createElement('div');
            div.className = 'log-line';
            const time = new Date().toLocaleTimeString();
            div.innerText = `[${time}] ${msg}`;
            if(type === 'error') div.classList.add('log-error');
            if(type === 'highlight') div.classList.add('log-highlight');
            
            debugConsole.appendChild(div);
            debugConsole.scrollTop = debugConsole.scrollHeight; // Auto scroll
        }

        // --- IMAGE LOADER CHECK ---
        const cardImg = document.getElementById('reveal-card');
        
        log(`Attempting to load image: ${cardImg.src}`);
        
        cardImg.onload = () => {
            log("âœ… Image loaded successfully from URL!", "highlight");
            log(`Image size: ${cardImg.naturalWidth}x${cardImg.naturalHeight}`);
        };
        
        cardImg.onerror = () => {
            log("âŒ ERROR: Image failed to load. Check internet or URL.", "error");
        };

        // --- DRAWING LOGIC ---
        const canvas = document.getElementById('paint-canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('canvas-wrapper');

        function resize() {
            canvas.width = wrapper.clientWidth;
            canvas.height = wrapper.clientHeight;
            log(`Canvas Resized: ${canvas.width}x${canvas.height}`);
        }
        window.onresize = resize;
        setTimeout(resize, 100); // Ensure it runs after load

        let painting = false;
        function startPosition(e) { painting = true; draw(e); }
        function finishedPosition() { painting = false; ctx.beginPath(); }
        function draw(e) {
            if (!painting) return;
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#333';
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }
        canvas.addEventListener('touchstart', startPosition);
        canvas.addEventListener('touchend', finishedPosition);
        canvas.addEventListener('touchmove', draw);

        // --- VOICE LOGIC ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const titleBtn = document.getElementById('secret-btn');
        let recognition;
        let isListening = false;

        if (SpeechRecognition) {
            log("Browser supports Speech API.");
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                log("ðŸŽ¤ Microphone STARTED. Listening...", "highlight");
                titleBtn.style.color = "blue";
            };

            recognition.onend = () => {
                log("Microphone STOPPED.");
                titleBtn.style.color = "black";
                if(isListening) {
                    log("Auto-restarting microphone...");
                    try { recognition.start(); } catch(e) { log("Restart error: " + e.message); }
                }
            };

            recognition.onerror = (event) => {
                log("âš ï¸ Speech Error: " + event.error, "error");
            };

            recognition.onresult = (event) => {
                const last = event.results.length - 1;
                const transcript = event.results[last][0].transcript.toLowerCase().trim();
                const confidence = event.results[last][0].confidence;
                
                // LOG WHAT IS HEARD
                log(`Heard: "${transcript}" (Confidence: ${confidence.toFixed(2)})`);

                // CHECK TRIGGER
                // Note: I added "ace of diamond" (singular) just in case
                if (transcript.includes("ace of diamonds") || transcript.includes("ace of diamond")) {
                    log("ðŸŽ¯ KEYWORD MATCHED! Triggering reveal...", "highlight");
                    revealTheCard();
                }
            };

        } else {
            log("âŒ Browser does NOT support Speech API.", "error");
        }

        titleBtn.addEventListener('click', () => {
            if (!isListening) {
                log("User tapped Start.");
                try {
                    isListening = true;
                    recognition.start();
                } catch (e) { log("Start Exception: " + e.message, "error"); }
            } else {
                log("User tapped Stop.");
                isListening = false;
                recognition.stop();
            }
        });

        function revealTheCard() {
            log("Apply .show class to image.");
            cardImg.classList.add('show');
            log("Reveal function complete. Is image visible?");
            
            // Stop listening to prevent double triggers
            isListening = false;
            recognition.stop();
        }

    </script>
</body>
</html>

