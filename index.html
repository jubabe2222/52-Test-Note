<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visual Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==================================================================
        // ‚úÖ YOUR FIREBASE KEYS
        // ==================================================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyCUsarWlf5256d-n96ZwuxJmInNQ2tU70o",
            authDomain: "magicdeck-ea75a.firebaseapp.com",
            projectId: "magicdeck-ea75a",
            storageBucket: "magicdeck-ea75a.firebasestorage.app",
            messagingSenderId: "134148843112",
            appId: "1:134148843112:web:0227c55453ee51d5f57ddd",
            measurementId: "G-4Y3MMSN4NF"
        };

        // ==================================================================
        
        let app, auth, db;
        let user = null;
        let isReceiver = false;
        let lastTimestamp = Date.now();

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            
            signInAnonymously(auth).catch((err) => {
                console.error("Auth Failed:", err);
            });
            
            onAuthStateChanged(auth, (u) => {
                if (u) {
                    user = u;
                    checkMode();
                }
            });
        } catch (e) { 
            console.error("Firebase Init Error:", e);
        }

        function checkMode() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'receiver') {
                isReceiver = true;
                initReceiver();
            } else {
                initSpectator();
            }
        }

        // --- SPECTATOR MODE (SENDER) ---
        function initSpectator() {
            document.getElementById('start-overlay').style.display = 'flex';
        }

        window.sendToCloud = async function(cardName) {
            if (!user || !db) return;
            const docRef = doc(db, 'magic_data', 'live_session');
            try {
                await setDoc(docRef, {
                    card: cardName,
                    timestamp: Date.now()
                });
            } catch (e) { console.error(e); }
        }

        // --- RECEIVER MODE (BLACK SCREEN STEALTH) ---
        function initReceiver() {
            // 1. Blackout everything
            document.body.innerHTML = '';
            // Cursor none hides mouse, select-none prevents highlighting text
            document.body.className = "bg-black h-screen w-screen overflow-hidden cursor-none select-none touch-manipulation"; 
            
            // 2. Add Double Tap Listener for Fullscreen
            document.body.addEventListener('dblclick', toggleFullScreen);

            // 3. Create the stealth container
            const stealthContainer = document.createElement('div');
            stealthContainer.id = "stealth-toast";
            // Tailwind: Fixed at bottom, small text (text-xs), grey color, 0 opacity initially
            stealthContainer.className = "fixed bottom-8 w-full text-center text-xs font-mono tracking-[0.2em] text-gray-500 opacity-0 transition-opacity duration-1000 pointer-events-none";
            stealthContainer.innerHTML = "...";
            document.body.appendChild(stealthContainer);

            // 4. Listen for signals
            const docRef = doc(db, 'magic_data', 'live_session');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.timestamp > lastTimestamp) {
                        lastTimestamp = data.timestamp;
                        triggerStealthReveal(data.card);
                    }
                }
            });
        }

        function triggerStealthReveal(text) {
            const el = document.getElementById('stealth-toast');
            
            el.innerText = text;
            el.style.opacity = '0.5'; // 50% opacity
            
            // Vibrate short pulse
            if(navigator.vibrate) navigator.vibrate(50);

            // Stay for 5 seconds, then fade out
            setTimeout(() => {
                el.style.opacity = '0';
            }, 5000);
        }

        // Shared Fullscreen Logic
        window.toggleFullScreen = function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch((e) => {
                    console.log("Fullscreen blocked (iOS requires 'Add to Home Screen'):", e);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .smooth-scroll { -webkit-overflow-scrolling: touch; }
        .selected-pulse { animation: weakPulse 1s ease-in-out; border-color: rgba(34, 197, 94, 0.5) !important; }
        @keyframes weakPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="bg-zinc-950 h-screen w-screen overflow-hidden text-white font-sans select-none flex flex-col">

    <!-- OVERLAY -->
    <div id="start-overlay" class="hidden absolute inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-500">
        <div class="text-center p-6">
            <div class="text-6xl mb-6">üëÅÔ∏è</div>
            <h1 class="text-2xl font-light tracking-widest uppercase mb-8 text-gray-400">Visual Suite</h1>
            <button onclick="startApp()" class="px-8 py-3 border border-gray-600 rounded-full text-sm tracking-widest hover:bg-gray-800 transition-colors active:scale-95">
                START
            </button>
        </div>
    </div>

    <!-- HOME MENU -->
    <div id="home-menu" class="hidden w-full h-full flex flex-col items-center justify-center p-6 space-y-3 relative overflow-y-auto">
        <button onclick="toggleFullScreen()" class="absolute top-6 right-6 p-3 text-zinc-600 hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
        </button>

        <h2 class="text-xs uppercase tracking-[0.2em] text-gray-500 mb-4 mt-8">Select Visual Set</h2>
        
        <div class="grid grid-cols-2 gap-3 w-full max-w-sm pb-8">
            <button onclick="loadCategory('cards')" class="col-span-2 py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mr-3">üÉè</span> <span class="font-light tracking-wide">Poker Deck</span></button>
            <button onclick="loadCategory('bini')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mb-1">üå∏</span> <span class="text-sm font-light">BINI</span></button>
            <button onclick="loadCategory('brands')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mb-1">üè∑Ô∏è</span> <span class="text-sm font-light">Brands</span></button>
            <button onclick="loadCategory('colors')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mb-1">üé®</span> <span class="text-sm font-light">Colors</span></button>
            <button onclick="loadCategory('esp')" class="py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mb-1">üîÆ</span> <span class="text-sm font-light">ESP</span></button>
            <button onclick="loadCategory('places')" class="col-span-2 py-4 bg-zinc-900 border border-zinc-800 rounded-xl flex items-center justify-center hover:bg-zinc-800 active:scale-95"><span class="text-2xl mr-3">üåç</span> <span class="font-light tracking-wide">Places</span></button>
        </div>
    </div>

    <!-- CAROUSEL -->
    <div id="carousel-view" class="hidden w-full h-full flex flex-col items-center justify-center relative opacity-0 transition-opacity duration-500">
        <button onclick="goHome()" class="absolute top-6 left-6 z-20 p-2 text-white/50 hover:text-white transition-colors bg-black/20 rounded-full backdrop-blur-sm">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" /></svg>
        </button>
        <div id="category-title" class="absolute top-8 text-xs font-bold tracking-[0.3em] text-zinc-500 uppercase z-10">CATEGORY</div>
        <div class="absolute inset-0 bg-zinc-950 pointer-events-none"></div>
        <div id="deck-scroller" class="relative w-full h-3/4 flex overflow-x-auto snap-x snap-mandatory no-scrollbar smooth-scroll items-center px-[calc(50vw-140px)] z-10"></div>
        <div class="absolute bottom-8 text-gray-600 text-xs tracking-widest uppercase">Focus to select</div>
    </div>

    <script>
        // CONFIG
        const DATA = {
            cards: { title: "Playing Cards", type: "poker", items: [] },
            bini: { title: "BINI Members", type: "photo", items: [
                { name: "Aiah", image: "Aiah.png" }, { name: "Colet", image: "Colet.png" }, { name: "Gwen", image: "Gwen.png" }, { name: "Jhoanna", image: "hoanna.png" }, { name: "Maloi", image: "Maloi.png" }, { name: "Mikha", image: "Mikha.png" }, { name: "Sheena", image: "Sheena.png" }, { name: "Stacey", image: "Stacey.png" }
            ]},
            brands: { title: "Famous Brands", type: "photo", items: [
                { name: "Amazon", image: "Amazon.png" }, { name: "Apple", image: "Apple.png" }, { name: "Canon", image: "Canon.png" }, { name: "Coca Cola", image: "Coca Cola.png" }, { name: "Fedex", image: "Fedex.png" }, { name: "Instagram", image: "Instagram.png" }, { name: "McDonalds", image: "Mcdonalds.png" }, { name: "Nintendo", image: "Nintendo.png" }, { name: "Nike", image: "Nike.png" }, { name: "Shell", image: "Shell.png" }, { name: "Starbucks", image: "Starbucks.png" }, { name: "Twitter", image: "Twitter.png" }
            ]},
            colors: { title: "Colors", type: "photo", items: [
                { name: "Black", image: "Black.png" }, { name: "Blue", image: "Blue.png" }, { name: "Brown", image: "Brown.png" }, { name: "Gray", image: "Gray.png" }, { name: "Green", image: "Green.png" }, { name: "Orange", image: "Orange.png" }, { name: "Pink", image: "Pink.png" }, { name: "Red", image: "Red.png" }, { name: "Violet", image: "Violet.png" }, { name: "White", image: "White.png" }, { name: "Yellow", image: "Yellow.png" }
            ]},
            esp: { title: "ESP Symbols", type: "photo", items: [
                { name: "Circle", image: "Circle.png" }, { name: "Cross", image: "Cross.png" }, { name: "Square", image: "Square.png" }, { name: "Star", image: "Star.png" }, { name: "Wavy Lines", image: "Wavy.png" }
            ]},
            places: { title: "Famous Places", type: "photo", items: [
                { name: "Chocolate Hills", image: "Chocolate Hills.png" }, { name: "Eiffel Tower", image: "Eiffel Tower.png" }, { name: "Luneta Park", image: "Luneta Park.png" }, { name: "Pyramid", image: "Pyramid.png" }, { name: "Rice Terraces", image: "Rice Terraces.png" }, { name: "Statue of Liberty", image: "Statue of Liberty.png" }, { name: "Taj Mahal", image: "Taj Mahal.png" }, { name: "Tower of Pisa", image: "Tower of Pisa.png" }
            ]}
        };

        // Poker Gen
        const suits = [{n:'Spades',s:'‚ô†',c:'text-black'},{n:'Hearts',s:'‚ô•',c:'text-red-600'},{n:'Clubs',s:'‚ô£',c:'text-black'},{n:'Diamonds',s:'‚ô¶',c:'text-red-600'}];
        const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        for(let s of suits){ for(let r of ranks){ DATA.cards.items.push({rank:r,suit:s.n,symbol:s.s,color:s.c,name:`${r} of ${s.n}`,type:'poker'}); }}

        let scrollTimeout = null;

        function startApp() {
            document.getElementById('start-overlay').style.display = 'none';
            document.getElementById('home-menu').classList.remove('hidden');
        }

        window.loadCategory = function(key) {
            const data = DATA[key];
            let items = [...data.items].sort(() => Math.random() - 0.5);
            const scroller = document.getElementById('deck-scroller');
            scroller.innerHTML = '';
            document.getElementById('category-title').innerText = data.title;

            items.forEach(item => {
                const el = document.createElement('div');
                el.className = `card-element flex-shrink-0 w-[280px] h-[420px] rounded-2xl shadow-2xl snap-center mx-4 relative flex flex-col justify-between border-4 border-transparent overflow-hidden bg-white`;
                el.dataset.name = item.name;

                if (data.type === 'poker') {
                    el.classList.add('p-6');
                    el.innerHTML = `<div class="text-3xl font-bold ${item.color} flex flex-col items-center leading-none"><span>${item.rank}</span><span class="text-2xl">${item.symbol}</span></div><div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl ${item.color}">${item.symbol}</span></div><div class="text-3xl font-bold ${item.color} flex flex-col items-center leading-none transform rotate-180"><span>${item.rank}</span><span class="text-2xl">${item.symbol}</span></div>`;
                } else {
                    el.innerHTML = `<img src="${item.image}" class="absolute inset-0 w-full h-full object-contain bg-white pb-10" onerror="this.src='https://placehold.co/600x900?text=Image+Missing'"><div class="absolute bottom-0 w-full text-center bg-black/80 py-3 border-t border-white/10"><h2 class="text-white font-bold text-lg uppercase tracking-widest leading-none">${item.name}</h2></div>`;
                }
                scroller.appendChild(el);
            });

            document.getElementById('home-menu').classList.add('hidden');
            document.getElementById('carousel-view').classList.remove('hidden');
            setTimeout(() => document.getElementById('carousel-view').classList.remove('opacity-0'), 50);
        }

        window.goHome = function() {
            if(scrollTimeout) clearTimeout(scrollTimeout);
            document.getElementById('carousel-view').classList.add('opacity-0');
            setTimeout(() => {
                document.getElementById('carousel-view').classList.add('hidden');
                document.getElementById('home-menu').classList.remove('hidden');
            }, 500);
        }

        // Logic
        document.getElementById('deck-scroller').addEventListener('scroll', () => {
            if(scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(identifyAndSend, 3000); // 3 Second Wait
        });

        function identifyAndSend() {
            const cards = document.getElementsByClassName('card-element');
            const scroller = document.getElementById('deck-scroller');
            const center = scroller.getBoundingClientRect().width / 2;
            let idx = -1, min = Infinity;

            for(let i=0; i<cards.length; i++){
                const rect = cards[i].getBoundingClientRect();
                const dist = Math.abs(center - (rect.left + rect.width/2));
                if(dist < min){ min = dist; idx = i; }
            }

            if(idx !== -1) {
                if(window.sendToCloud) window.sendToCloud(cards[idx].dataset.name);
            }
        }
    </script>
</body>
</html>


